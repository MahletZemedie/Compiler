#include <stdio.h>
#include "stack.h"
#include "lex.yy.c"

#define shift  1
#define reduce 2
#define accept 3

int headSymbol[10] = {0,1,1,2,2,3,3,4,4,5}; //head symbol of rule i, 0 <= i <= 9

int action[17][7][2] = {
  1, 2,  -1,-1,  -1,-1,  -1,-1,   1, 1,  -1,-1,  -1,-1,
  1, 2,  -1,-1,  -1,-1,  -1,-1,   1, 1,  -1,-1,  -1,-1,
 -1,-1,   2, 9,   2, 9,   2, 9,  -1,-1,   2, 9,   2, 9,
 -1,-1,   1,10,  -1,-1,  -1,-1,  -1,-1,  -1,-1,   3,-1,
 -1,-1,   2, 1,   1,11,  -1,-1,  -1,-1,   2, 1,   2, 1,
 -1,-1,   2, 3,   2, 3,  -1,-1,  -1,-1,   2, 3,   2, 3,
 -1,-1,   2, 5,   2, 5,   1,12,  -1,-1,   2, 5,   2, 5,
 -1,-1,   2, 7,   2, 7,   2, 7,  -1,-1,   2, 7,   2, 7,
 -1,-1,   1,10,  -1,-1,  -1,-1,  -1,-1,   1,13,  -1,-1,
 -1,-1,  -1,-1,  -1,-1,  -1,-1,  -1,-1,  -1,-1,  -1,-1,
  1, 2,  -1,-1,  -1,-1,  -1,-1,   1, 1,  -1,-1,  -1,-1,
  1, 2,  -1,-1,  -1,-1,  -1,-1,   1, 1,  -1,-1,  -1,-1,
  1, 2,  -1,-1,  -1,-1,  -1,-1,   1, 1,  -1,-1,  -1,-1,
 -1,-1,   2, 8,   2, 8,   2, 8,  -1,-1,   2, 8,   2, 8,
 -1,-1,   2, 2,   1,11,  -1,-1,  -1,-1,   2, 2,   2, 2,
 -1,-1,   2, 4,   2, 4,  -1,-1,  -1,-1,   2, 4,   2, 4,
 -1,-1,   2, 6,   2, 6,  -1,-1,  -1,-1,   2, 6,   2, 6
};
 
int go_to[17][6] = {
  -1,  3,  4,  5,  6,  7,
  -1,  8,  4,  5,  6,  7,
  -1, -1, -1, -1, -1, -1,
  -1, -1, -1, -1, -1, -1,
  -1, -1, -1, -1, -1, -1,
  -1, -1, -1, -1, -1, -1,
  -1, -1, -1, -1, -1, -1,
  -1, -1, -1, -1, -1, -1,
  -1, -1, -1, -1, -1, -1,
  -1, -1, -1, -1, -1, -1,
  -1, -1, 14,  5,  6,  7,
  -1, -1, -1, 15,  6,  7,
  -1, -1, -1, 16,  6,  7,
  -1, -1, -1, -1, -1, -1,
  -1, -1, -1, -1, -1, -1,
  -1, -1, -1, -1, -1, -1,
  -1, -1, -1, -1, -1, -1
};

int f(int a) { return (a + 6)%7; }

void main() {


stack stk = new_stack();

int beta;
int a;
int s;
int t;

/* to be completed (declare variables) */
push(stk, 0);
a = yylex();
while (1) {
s = top(stk);

if (action[s][f(a)][0] == shift) {
 	 t=action[s][f(a)][1];
  	 push(stk,t);
	 printf("s%d\n", action[s][f(a)][1]);
	 a = yylex();
} else if (action[s][f(a)][0] == reduce) {
       t=action[s][f(a)][1];
       printf("r%d\n", t);
       beta=pop(stk);
    if(t%2==0){
       beta=pop(stk);
       beta= pop(stk);
   }
 	  s=top(stk);
 	 push(stk,go_to[s][headSymbol[t]] );
 	 printf("goto %d\n",go_to[s][headSymbol[t]]);

} else if (action[s][f(a)][0] == accept) {printf("acc\n"); break;}
else {printf("error\n"); exit(-1);}
}
}
